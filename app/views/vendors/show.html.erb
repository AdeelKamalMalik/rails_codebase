<div data-controller="vendors contracts" data-contracts-open-tab="<%= params[:tab].present? ? params[:tab] : @contracts.first.public_id %>" x-data="{ openTab: '<%= params[:tab].present? ? params[:tab] : @contracts.first.public_id %>'}">
  <div id="move_document_success_banner" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative flex items-center">
    <%= image_tag "icons/tick-icon.svg", id: "successIcon", class: "w-6 h-6 mr-2 hidden" %>
    <%= image_tag "icons/expiring-soon.svg", id: "warningIcon", class: "w-6 h-6 mr-2 hidden" %>
    <span id="bannerText"></span>
  </div>
  <div class="md:mt-16 mt-8 container mx-auto md:px-16">
    <div class="flex flex-wrap items-center justify-between">
      <div class="flex items-center gap-6">
        <%= image_tag "https://img.logo.dev/#{@vendor.domain}?token=#{ENV['LOGO_DEV']}&size=84&format=png", { onerror: "this.src='#{asset_path('icons/empty.svg')}'", class: "w-[84px] rounded-lg" } %>
        <input id="vendor-name-input" type="text" value="<%= @vendor.name || 'Gong FY23' %>" class="border-gray-200 rounded-lg hidden">
        <span id="vendor-name"><%= @vendor.name || 'Gong FY23' %></span>
        <div class="relative inline-block text-left" data-controller="dropdown">
          <div>
            <p id="vendor-name-saved-text" class="text-green-600 hidden" style="font-weight: bold;"> Saved </p>
            <button type="button" class="flex items-center" id="menu-button" aria-expanded="true" aria-haspopup="true" data-action="click->dropdown#toggle click@window->dropdown#hide">
            <span class="sr-only">Open options</span>
            <%= image_tag "icons/horizontal-three-dots.svg" %>
            </button>
          </div>
          <div data-dropdown-target="menu"
            data-transition-enter="transition ease-out duration-200"
            data-transition-enter-from="opacity-0 translate-y-1"
            data-transition-enter-to="opacity-100 translate-y-0"
            data-transition-leave="transition ease-in duration-150"
            data-transition-leave-from="opacity-100 translate-y-0"
            data-transition-leave-to="opacity-0 translate-y-1"
            class="absolute hidden z-10 mt-2 w-56 origin-top-right rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
            <div class="py-1" role="none">
              <p class="hover:bg-gray-200 text-slate-600 cursor-pointer px-5 py-2" role="menuitem" tabindex="-1" id="downloadCsvMenuItem">
                <%= link_to 'Download as CSV', download_csv_vendor_path(format: 'csv', public_id: @vendor.public_id), class: 'btn-link text-slate-600 hover:text-slate-600' %>
              </p>
              <p class="hover:bg-gray-200 text-slate-600 cursor-pointer px-5 py-2" role="menuitem" tabindex="-1" id="rename-vendor">Rename Vendor</p>
              <p class="hover:bg-gray-200 text-slate-600 cursor-pointer px-5 py-2" role="menuitem" tabindex="-1" id="archiveVendorMenuItem">
                <%= link_to @vendor.archived? ? 'Unarchive Vendor' : 'Archive Vendor', @vendor.archived? ? unarchive_vendor_path(@vendor) : archive_vendor_path(@vendor), class: 'btn-link text-slate-600 hover:text-slate-600' %>
              </p>
              <hr class="text-gray-100">
              <div class="my-3" role="none">
                <span class="text-slate-500 cursor-pointer px-5 py-2" role="menuitem" tabindex="-1" id="menu-item-3">Vendor ID</span>
                <p class="hover:bg-gray-200 text-slate-500 cursor-pointer px-5 py-2" role="menuitem" tabindex="-1" id="menu-item-3"><%= @vendor.public_id %></p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="mt-8 md:mt-0">
        <div class='inline-flex btn btn-primary nav-link text-white hover:text-white text-sm p-5' data-controller="settings" data-action="click->settings#openModal"
          <% if current_user.contract_limit_reached? %>
            data-subscribed-plan="<%= current_user.subscribed_plan&.name %>"
            data-modal-id='upgradeModal'
          <% else %>
            data-modal-id='newContract'
          <% end %>
          data-vendor-id="<%= @vendor.public_id %>">
          <%= render_svg "icons/plus", styles: "mr-2" %> New Contract
        </div>
        <svg width="592" class="top-[3.6rem] right-0 -z-30 absolute hidden md:block" height="220" viewBox="0 0 592 220" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g filter="url(#filter0_f_2933_8897)">
            <ellipse cx="388.5" cy="247" rx="138.5" ry="138" fill="#BFDBFE"/>
          </g>
          <defs>
            <filter id="filter0_f_2933_8897" x="0" y="-141" width="777" height="776" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
              <feFlood flood-opacity="0" result="BackgroundImageFix"/>
              <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
              <feGaussianBlur stdDeviation="125" result="effect1_foregroundBlur_2933_8897"/>
            </filter>
          </defs>
        </svg>
      </div>
    </div>
    <div>
      <div>
        <svg class="top-[3.6rem] -z-30 left-[22rem] absolute hidden md:block" width="645" height="220" viewBox="0 0 645 220" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g filter="url(#filter0_f_2914_8896)">
            <ellipse cx="322.5" cy="296" rx="122.5" ry="122" fill="#BFDBFE"/>
          </g>
          <defs>
            <filter id="filter0_f_2914_8896" x="0" y="-26" width="645" height="644" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
              <feFlood flood-opacity="0" result="BackgroundImageFix"/>
              <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
              <feGaussianBlur stdDeviation="100" result="effect1_foregroundBlur_2914_8896"/>
            </filter>
          </defs>
        </svg>
      </div>
      <ul class="flex flex-wrap px-2 mt-7 whitespace-nowrap gap-4">
        <% @contracts.each_with_index do |contract, index| %>
          <div data-controller="contracts"  x-on:click="openTab = '<%= contract.public_id %>' ; $dispatch('set-current-tab-contract-id', { contractPublicId: '<%= contract.public_id %>' })" :class="{ 'border-b-2 border-indigo-500': openTab === '<%= contract.public_id %>' }" class="py-2 cursor-pointer flex gap-2">
            <span class="contract-name<%= contract.id %>"><%= contract.name %></span>
            <% if contract.ending_in? %>
              <%= image_tag "icons/warning-alert.svg" %>
            <% end %>
          </div>
        <% end %>
      </ul>
    </div>
  </div>
  <div class="border-b border-gray-200"></div>
  <div data-controller="contracts" class="container mx-auto md:px-16 mt-14">
    <% @contracts.each_with_index do |contract, index| %>
      <div id="contract-details-container" x-show="openTab === '<%= contract.public_id %>'" class="w-full" x-data="{ edit: 'general-<%= contract.id %>'}">
        <%= render partial: 'contracts/contract_header', locals: { contract: contract } %>
      </div>
    <% end %>
  </div>
</div>
<%= render 'contracts/contract_modal' %>
<%= render 'subscriptions/upgrade_modal' %>
<%= render 'contract_files/move_file_modal' %>
<%= render 'contracts/delete_confirmation_modal' %>

